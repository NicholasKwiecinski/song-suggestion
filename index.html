<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Song Suggestion</title>
    <style>
        body {
            font-family: Arial;
        }

        /* Style the tab */
        .tab {
            overflow: hidden;
            border: 1px solid #ccc;
            background-color: #f1f1f1;
        }

        /* Style the buttons inside the tab */
        .tab button {
            background-color: inherit;
            float: left;
            border: none;
            outline: none;
            cursor: pointer;
            padding: 7px 8px;
            transition: 0.3s;
            font-size: 17px;
        }

        /* Change background color of buttons on hover */
        .tab button:hover {
            background-color: #ddd;
        }

        /* Create an active/current tablink class */
        .tab button.active {
            background-color: #ccc;
        }

        /* Style the tab content */
        .tabcontent {
            display: none;
            padding: 0px 0px;
            border: none;
            border-top: none;
        }
    </style>
</head>

<body>


    <div class="tab">
        <button class="tablinks" onclick="openCity(event, 'covers')" id="defaultOpen">Covers</button>
    </div>

    <br>

    <div id="covers" class="tabcontent">
        <h3>Cover Songs</h3>
        <p>Click column header to sort by that category.<br>Click on a song title to send a request SMS!</p>
        <table id="myTable">
            <thead>
                <tr>
                    <th align="left" onclick="sortTable(0)">Artist</th>
                    <th align="left" onclick="sortTable(1)">Song</th>
                    <th align="left" onclick="sortTable(2)">Genre</th>
                    <th align="left" onclick="sortTable(3)">Year</th>
                </tr>
            </thead>
            <tbody>
                <!-- Data will be populated here -->
            </tbody>
        </table>

        <script>
            function sortTable(n) {
                var table, rows, switching, i, x, y, shouldSwitch, dir, switchcount = 0;
                table = document.getElementById("myTable");
                switching = true;
                dir = "asc";
                while (switching) {
                    switching = false;
                    rows = table.rows;
                    for (i = 1; i < (rows.length - 1); i++) {
                        shouldSwitch = false;
                        x = rows[i].getElementsByTagName("TD")[n];
                        y = rows[i + 1].getElementsByTagName("TD")[n];
                        if (dir == "asc") {
                            if (x.innerHTML.toLowerCase() > y.innerHTML.toLowerCase()) {
                                shouldSwitch = true;
                                break;
                            }
                        } else if (dir == "desc") {
                            if (x.innerHTML.toLowerCase() < y.innerHTML.toLowerCase()) {
                                shouldSwitch = true;
                                break;
                            }
                        }
                    }
                    if (shouldSwitch) {
                        rows[i].parentNode.insertBefore(rows[i + 1], rows[i]);
                        switching = true;
                        switchcount++;
                    } else {
                        if (switchcount == 0 && dir == "asc") {
                            dir = "desc";
                            switching = true;
                        }
                    }
                }
            }

            function openCity(evt, cityName) {
                var i, tabcontent, tablinks;
                tabcontent = document.getElementsByClassName("tabcontent");
                for (i = 0; i < tabcontent.length; i++) {
                    tabcontent[i].style.display = "none";
                }
                tablinks = document.getElementsByClassName("tablinks");
                for (i = 0; i < tablinks.length; i++) {
                    tablinks[i].className = tablinks[i].className.replace(" active", "");
                }
                document.getElementById(cityName).style.display = "block";
                evt.currentTarget.className += " active";
            }

            document.getElementById("defaultOpen").click();

            async function fetchCSV() {
                const response = await fetch('https://docs.google.com/spreadsheets/d/e/2PACX-1vT0F7SvyyyOsonuF1mchu5ObkSNv-k1MBRL6WWr3OA4mdIRjz0fDSHiaBQmfJrMc4o6NMgVVBkA0j6U/pub?output=csv');
                const data = await response.text();
                const rows = data.split('\n').slice(1); // Remove header row
                const tableBody = document.querySelector('#myTable tbody');
                rows.forEach(row => {
                    const cols = row.split(',');
                    if (cols.length >= 4) {
                        const tr = document.createElement('tr');
                        tr.innerHTML = `
                                <td>${cols[0]}</td>
                                <td><a href="sms:+15555555555&body=Requesting%20${encodeURIComponent(cols[1])}%20by%20${encodeURIComponent(cols[0])}">${cols[1]}</a></td>
                                <td>${cols[2]}</td>
                                <td>${cols[3]}</td>
                            `;
                        tableBody.appendChild(tr);
                    }
                });
            }
            fetchCSV();
        </script>

    </div>
</body>

</html>